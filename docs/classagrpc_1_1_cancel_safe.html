<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="light-mode">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>asio-grpc: agrpc::CancelSafe&lt; CompletionArgs &gt; Class Template Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">asio-grpc<span id="projectnumber">&#160;v1.6.0</span>
   </div>
   <div id="projectbrief">Asynchronous gRPC with Asio/unified executors</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('classagrpc_1_1_cancel_safe.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classagrpc_1_1_cancel_safe-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">agrpc::CancelSafe&lt; CompletionArgs &gt; Class Template Reference</div></div>
</div><!--header-->
<div class="contents">

<p>(experimental) Cancellation safety for asynchronous operations  
 <a href="classagrpc_1_1_cancel_safe.html#details">More...</a></p>

<p><code>#include &lt;agrpc/cancelSafe.hpp&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aac7be374de964fe0e71af47bcdf6e473"><td class="memItemLeft" align="right" valign="top">auto&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classagrpc_1_1_cancel_safe.html#aac7be374de964fe0e71af47bcdf6e473">token</a> () noexcept</td></tr>
<tr class="memdesc:aac7be374de964fe0e71af47bcdf6e473"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a completion token to initiate asynchronous operations.  <a href="classagrpc_1_1_cancel_safe.html#aac7be374de964fe0e71af47bcdf6e473">More...</a><br /></td></tr>
<tr class="separator:aac7be374de964fe0e71af47bcdf6e473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8f073954095be29298b864ee0f39cfa"><td class="memTemplParams" colspan="2">template&lt;class CompletionToken &gt; </td></tr>
<tr class="memitem:ab8f073954095be29298b864ee0f39cfa"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classagrpc_1_1_cancel_safe.html#ab8f073954095be29298b864ee0f39cfa">wait</a> (CompletionToken <a class="el" href="classagrpc_1_1_cancel_safe.html#aac7be374de964fe0e71af47bcdf6e473">token</a>)</td></tr>
<tr class="memdesc:ab8f073954095be29298b864ee0f39cfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wait for the asynchronous operation to complete.  <a href="classagrpc_1_1_cancel_safe.html#ab8f073954095be29298b864ee0f39cfa">More...</a><br /></td></tr>
<tr class="separator:ab8f073954095be29298b864ee0f39cfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><div class="compoundTemplParams">template&lt;class... CompletionArgs&gt;<br />
class agrpc::CancelSafe&lt; CompletionArgs &gt;</div><p >(experimental) Cancellation safety for asynchronous operations </p>
<p >This class provides a completion token that can be used to initiate asynchronous operations in a cancellation safe manner. A second method of this class is then used to wait for the operation to complete. Cancelling said waiting will not cancel the underlying operation but still invoke the completion handler with <code>asio::error::operation_aborted</code>. This can be useful in combination with <code>asio::parallel_group</code> or <code>asio::awaitable_operators</code>, e.g. to perform an action every 100ms while waiting for a server-stream:</p>
<div class="fragment"><div class="line">    grpc::ClientContext client_context;</div>
<div class="line">    example::v1::Request <a class="code hl_variable" href="namespaceagrpc.html#a4a11653afb11f9486e4e3db0136a3e08">request</a>;</div>
<div class="line">    std::unique_ptr&lt;grpc::ClientAsyncReader&lt;example::v1::Response&gt;&gt; reader;</div>
<div class="line">    <span class="keyword">co_await</span> <a class="code hl_variable" href="namespaceagrpc.html#a4a11653afb11f9486e4e3db0136a3e08">agrpc::request</a>(&amp;example::v1::Example::Stub::AsyncServerStreaming, stub, client_context, <a class="code hl_variable" href="namespaceagrpc.html#a4a11653afb11f9486e4e3db0136a3e08">request</a>, reader);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classagrpc_1_1_cancel_safe.html">agrpc::GrpcCancelSafe</a> safe;  <span class="comment">// equivalent to agrpc::CancelSafe&lt;bool&gt;</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initiate a read with cancellation safety.</span></div>
<div class="line">    example::v1::Response response;</div>
<div class="line">    <a class="code hl_variable" href="namespaceagrpc.html#a685510388ab87c9a90c44f880e9de9cd">agrpc::read</a>(*reader, response, asio::bind_executor(grpc_context, safe.<a class="code hl_function" href="classagrpc_1_1_cancel_safe.html#aac7be374de964fe0e71af47bcdf6e473">token</a>()));</div>
<div class="line"> </div>
<div class="line">    grpc::Alarm alarm;</div>
<div class="line">    <span class="keywordtype">bool</span> ok{<span class="keyword">true</span>};</div>
<div class="line">    <span class="keywordflow">while</span> (ok)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">using namespace </span>asio::experimental::awaitable_operators;</div>
<div class="line">        <span class="keyword">auto</span> variant = <span class="keyword">co_await</span> (<a class="code hl_variable" href="namespaceagrpc.html#a3a4e32ff60d8f9bd8c8c68e42be959c1">agrpc::wait</a>(alarm, hundred_milliseconds_from_now()) || safe.<a class="code hl_function" href="classagrpc_1_1_cancel_safe.html#ab8f073954095be29298b864ee0f39cfa">wait</a>(asio::use_awaitable));</div>
<div class="line">        <span class="keywordflow">if</span> (0 == variant.index())  <span class="comment">// Alarm finished</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// The read continues in the background.</span></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span>  <span class="comment">// Read finished</span></div>
<div class="line">        {</div>
<div class="line">            ok = std::get&lt;1&gt;(variant);</div>
<div class="line">            <span class="keywordflow">if</span> (ok)</div>
<div class="line">            {</div>
<div class="line">                <span class="comment">// Initiate the next read.</span></div>
<div class="line">                <a class="code hl_variable" href="namespaceagrpc.html#a685510388ab87c9a90c44f880e9de9cd">agrpc::read</a>(*reader, response, asio::bind_executor(grpc_context, safe.<a class="code hl_function" href="classagrpc_1_1_cancel_safe.html#aac7be374de964fe0e71af47bcdf6e473">token</a>()));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="ttc" id="aclassagrpc_1_1_cancel_safe_html"><div class="ttname"><a href="classagrpc_1_1_cancel_safe.html">agrpc::CancelSafe&lt; bool &gt;</a></div></div>
<div class="ttc" id="aclassagrpc_1_1_cancel_safe_html_aac7be374de964fe0e71af47bcdf6e473"><div class="ttname"><a href="classagrpc_1_1_cancel_safe.html#aac7be374de964fe0e71af47bcdf6e473">agrpc::CancelSafe::token</a></div><div class="ttdeci">auto token() noexcept</div><div class="ttdoc">Create a completion token to initiate asynchronous operations.</div><div class="ttdef"><b>Definition:</b> cancelSafe.hpp:86</div></div>
<div class="ttc" id="aclassagrpc_1_1_cancel_safe_html_ab8f073954095be29298b864ee0f39cfa"><div class="ttname"><a href="classagrpc_1_1_cancel_safe.html#ab8f073954095be29298b864ee0f39cfa">agrpc::CancelSafe::wait</a></div><div class="ttdeci">auto wait(CompletionToken token)</div><div class="ttdoc">Wait for the asynchronous operation to complete.</div><div class="ttdef"><b>Definition:</b> cancelSafe.hpp:104</div></div>
<div class="ttc" id="anamespaceagrpc_html_a3a4e32ff60d8f9bd8c8c68e42be959c1"><div class="ttname"><a href="namespaceagrpc.html#a3a4e32ff60d8f9bd8c8c68e42be959c1">agrpc::wait</a></div><div class="ttdeci">constexpr detail::WaitFn wait</div><div class="ttdoc">Wait for a timer.</div><div class="ttdef"><b>Definition:</b> wait.hpp:78</div></div>
<div class="ttc" id="anamespaceagrpc_html_a4a11653afb11f9486e4e3db0136a3e08"><div class="ttname"><a href="namespaceagrpc.html#a4a11653afb11f9486e4e3db0136a3e08">agrpc::request</a></div><div class="ttdeci">constexpr detail::RequestFn request</div><div class="ttdoc">Start a new RPC.</div><div class="ttdef"><b>Definition:</b> rpc.hpp:1493</div></div>
<div class="ttc" id="anamespaceagrpc_html_a685510388ab87c9a90c44f880e9de9cd"><div class="ttname"><a href="namespaceagrpc.html#a685510388ab87c9a90c44f880e9de9cd">agrpc::read</a></div><div class="ttdeci">constexpr detail::ReadFn read</div><div class="ttdoc">Read from a streaming RPC.</div><div class="ttdef"><b>Definition:</b> rpc.hpp:1502</div></div>
</div><!-- fragment --><dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">CompletionArgs</td><td>The arguments of the completion signature. E.g. for <code>asio::steady_timer::async_wait</code> the completion arguments would be <code>boost::system::error_code</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section since"><dt>Since</dt><dd>1.6.0 (and Boost.Asio 1.77.0) </dd></dl>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="aac7be374de964fe0e71af47bcdf6e473" name="aac7be374de964fe0e71af47bcdf6e473"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac7be374de964fe0e71af47bcdf6e473">&#9670;&nbsp;</a></span>token()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class... CompletionArgs&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto <a class="el" href="classagrpc_1_1_cancel_safe.html">agrpc::CancelSafe</a>&lt; CompletionArgs &gt;::token </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">noexcept</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Create a completion token to initiate asynchronous operations. </p>
<p >Thread-safe </p>

</div>
</div>
<a id="ab8f073954095be29298b864ee0f39cfa" name="ab8f073954095be29298b864ee0f39cfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8f073954095be29298b864ee0f39cfa">&#9670;&nbsp;</a></span>wait()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;class... CompletionArgs&gt; </div>
<div class="memtemplate">
template&lt;class CompletionToken &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">auto <a class="el" href="classagrpc_1_1_cancel_safe.html">agrpc::CancelSafe</a>&lt; CompletionArgs &gt;::wait </td>
          <td>(</td>
          <td class="paramtype">CompletionToken&#160;</td>
          <td class="paramname"><em>token</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Wait for the asynchronous operation to complete. </p>
<p >Only one call to <code><a class="el" href="classagrpc_1_1_cancel_safe.html#ab8f073954095be29298b864ee0f39cfa" title="Wait for the asynchronous operation to complete.">wait()</a></code> may be outstanding at a time. Waiting for an already completed operation will immediately invoke the completion handler in a manner equivalent to using <code>asio::post</code>.</p>
<p >Not thread-safe with regards to successful completion of the asynchronous operation.</p>
<p ><b>Per-Operation Cancellation</b></p>
<p >All. Upon cancellation, the asynchronous operation continues to run.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">token</td><td>Completion token that matches the completion args. Either <code>void(error_code, CompletionArgs...)</code> if the first argument in CompletionArgs is not <code>error_code</code> or <code>void(CompletionArgs...)</code> otherwise. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceagrpc.html">agrpc</a></li><li class="navelem"><a class="el" href="classagrpc_1_1_cancel_safe.html">CancelSafe</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3 </li>
  </ul>
</div>
</body>
</html>
